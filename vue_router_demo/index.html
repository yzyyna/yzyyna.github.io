<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="favicon.ico" />
    <title>Vue Router demo</title>
  </head>
  <body>
    <script src="https://unpkg.com/vue@2.7/dist/vue.js"></script>
    <script src="https://unpkg.com/vue-router@3/dist/vue-router.js"></script>
    <link type="text/css" rel="stylesheet" href="style.css" />

    <div id="app">
      <h1>ğŸ˜ˆ</h1>
      <p>
        <!-- ä½¿ç”¨ router-link ç»„ä»¶æ¥å¯¼èˆª. -->
        <!-- é€šè¿‡ä¼ å…¥ `to` å±æ€§æŒ‡å®šé“¾æ¥. -->
        <!-- <router-link> é»˜è®¤ä¼šè¢«æ¸²æŸ“æˆä¸€ä¸ª `<a>` æ ‡ç­¾ -->
        <router-link to="/foo">Go to Foo</router-link>
        <router-link to="/bar">Go to Bar</router-link>
        <router-link to="/user-fff">Go to Any</router-link>
        <!-- åŠ¨æ€è·¯ç”± -->
        <router-link to="/user/0">Go to user/:id</router-link>
        <router-link to="/user/1">Go to user/:id</router-link>
        <!-- ä½ å¯ä»¥åœ¨ä¸€ä¸ªè·¯ç”±ä¸­è®¾ç½®å¤šæ®µâ€œè·¯å¾„å‚æ•°â€ï¼Œå¯¹åº”çš„å€¼éƒ½ä¼šè®¾ç½®åˆ° $route.params ä¸­ã€‚ -->
        <router-link to="/user/aa/sub/2?bb=123&cc=dte"
          >Go to user/:name/sub/:id</router-link
        >
      </p>
      <test-component :prop1="123"></test-component>
      <button @click="toUser">to User</button>
      <!-- è·¯ç”±å‡ºå£ -->
      <!-- è·¯ç”±åŒ¹é…åˆ°çš„ç»„ä»¶å°†æ¸²æŸ“åœ¨è¿™é‡Œ -->
      <router-view></router-view>
      <button @click="toIndex2">Go to Nested Routes demo</button>
    </div>
    <script>
      // 0. å¦‚æœä½¿ç”¨æ¨¡å—åŒ–æœºåˆ¶ç¼–ç¨‹ï¼Œå¯¼å…¥Vueå’ŒVueRouterï¼Œè¦è°ƒç”¨ Vue.use(VueRouter)

      // 1. å®šä¹‰ (è·¯ç”±) ç»„ä»¶ã€‚
      // å¯ä»¥ä»å…¶ä»–æ–‡ä»¶ import è¿›æ¥
      const Foo = { template: "<div>foo</div>" };
      const Bar = { template: "<div>bar</div>" };
      // åŠ¨æ€è·¯ç”±åŒ¹é…
      // ä¸€ä¸ªâ€œè·¯å¾„å‚æ•°â€ä½¿ç”¨å†’å· : æ ‡è®°ã€‚
      // å½“åŒ¹é…åˆ°ä¸€ä¸ªè·¯ç”±æ—¶ï¼Œå‚æ•°å€¼ä¼šè¢«è®¾ç½®åˆ° this.$route.paramsï¼Œ
      // å¯ä»¥åœ¨æ¯ä¸ªç»„ä»¶å†…ä½¿ç”¨ã€‚äºæ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥æ›´æ–° User çš„æ¨¡æ¿ï¼Œè¾“å‡ºå½“å‰ç”¨æˆ·çš„ ID
      const User = {
        template: "<div>User {{ $route.params.id }}</div>",
        // æé†’ä¸€ä¸‹ï¼Œå½“ä½¿ç”¨è·¯ç”±å‚æ•°æ—¶ï¼Œä¾‹å¦‚ä» /user/foo å¯¼èˆªåˆ° /user/barï¼Œ
        // åŸæ¥çš„ç»„ä»¶å®ä¾‹ä¼šè¢«å¤ç”¨ã€‚å› ä¸ºä¸¤ä¸ªè·¯ç”±éƒ½æ¸²æŸ“åŒä¸ªç»„ä»¶ï¼Œæ¯”èµ·é”€æ¯å†åˆ›å»ºï¼Œå¤ç”¨åˆ™æ˜¾å¾—æ›´åŠ é«˜æ•ˆã€‚
        // ä¸è¿‡ï¼Œè¿™ä¹Ÿæ„å‘³ç€ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸé’©å­ä¸ä¼šå†è¢«è°ƒç”¨ã€‚
        // å¤ç”¨ç»„ä»¶æ—¶ï¼Œæƒ³å¯¹è·¯ç”±å‚æ•°çš„å˜åŒ–ä½œå‡ºå“åº”çš„è¯ï¼Œä½ å¯ä»¥ç®€å•åœ° watch (ç›‘æµ‹å˜åŒ–) $route å¯¹è±¡ï¼š
        // æˆ–è€…ä½¿ç”¨ 2.2 ä¸­å¼•å…¥çš„ beforeRouteUpdate å¯¼èˆªå®ˆå«ï¼š
        beforeRouteUpdate(to, from, next) {
          // react to route changes...
          // don't forget to call next()
          console.log("$route changed in beforeRouteUpdate", to, from);
          next();
        },
      };
      const UserSub = {
        template: `<div>User Sub {{$route.params.name}},{{$route.params.id}}
          ,query:{{$route.query.bb}}{{$route.query.cc}}</div>`,
      };

      const Any = {
        template: `<div>Any{{$route.params.pathMatch}}</div>`,
      };
      const NotFound = {
        template: `<div>Not Found</div>`,
      };
      // 2. å®šä¹‰è·¯ç”±
      // æ¯ä¸ªè·¯ç”±åº”è¯¥æ˜ å°„ä¸€ä¸ªç»„ä»¶ã€‚ å…¶ä¸­"component" å¯ä»¥æ˜¯
      // é€šè¿‡ Vue.extend() åˆ›å»ºçš„ç»„ä»¶æ„é€ å™¨ï¼Œ
      // æˆ–è€…ï¼Œåªæ˜¯ä¸€ä¸ªç»„ä»¶é…ç½®å¯¹è±¡ã€‚
      // æˆ‘ä»¬æ™šç‚¹å†è®¨è®ºåµŒå¥—è·¯ç”±ã€‚
      const routes = [
        { path: "/foo", component: Foo },
        { path: "/bar", component: Bar },
        { path: "/user/:id", component: User },
        {
          path: "/user/:name/sub/:id",
          component: UserSub,
        },
        // æ•è·æ‰€æœ‰è·¯ç”±æˆ– 404 Not found è·¯ç”±
        // å½“ä½¿ç”¨ä¸€ä¸ªé€šé…ç¬¦æ—¶ï¼Œ$route.params å†…ä¼šè‡ªåŠ¨æ·»åŠ ä¸€ä¸ªåä¸º pathMatch å‚æ•°ã€‚
        // å®ƒåŒ…å«äº† URL é€šè¿‡é€šé…ç¬¦è¢«åŒ¹é…çš„éƒ¨åˆ†ï¼š
        // å½“ä½¿ç”¨é€šé…ç¬¦è·¯ç”±æ—¶ï¼Œè¯·ç¡®ä¿è·¯ç”±çš„é¡ºåºæ˜¯æ­£ç¡®çš„ï¼ŒæŒ‰é¡ºåºåŒ¹é…
        // ä¹Ÿå°±æ˜¯è¯´ã€å«æœ‰é€šé…ç¬¦çš„è·¯ç”±åº”è¯¥æ”¾åœ¨æœ€åã€‘ã€‚è·¯ç”± { path: '*' }
        // é€šå¸¸ç”¨äºå®¢æˆ·ç«¯ 404 é”™è¯¯ï¼ˆå› ä¸ºæ˜¯æœ€ååŒ¹é…åˆ°çš„è·¯ç”±ï¼‰ã€‚å¦‚æœä½ ä½¿ç”¨äº†History æ¨¡å¼ï¼Œè¯·ç¡®ä¿æ­£ç¡®é…ç½®ä½ çš„æœåŠ¡å™¨ã€‚
        {
          path: "*",
          component: NotFound,
        },
        {
          path: "/user-*",
          component: Any,
        },
      ];

      // 3. åˆ›å»º router å®ä¾‹ï¼Œç„¶åä¼  `routes` é…ç½®
      // ä½ è¿˜å¯ä»¥ä¼ åˆ«çš„é…ç½®å‚æ•°, ä¸è¿‡å…ˆè¿™ä¹ˆç®€å•ç€å§ã€‚
      const router = new VueRouter({
        routes, // (ç¼©å†™) ç›¸å½“äº routes: routes
      });

      // æ³¨å†Œäº†ä¸€ä¸ªç»„ä»¶è€è€
      Vue.component("test-component", {
        props: ["prop1"],
        template: `<div>{{prop1}} component</div>`,
      });
      // 4. åˆ›å»ºå’ŒæŒ‚è½½æ ¹å®ä¾‹ã€‚
      // è®°å¾—è¦é€šè¿‡ router é…ç½®å‚æ•°æ³¨å…¥è·¯ç”±ï¼Œ
      // ä»è€Œè®©æ•´ä¸ªåº”ç”¨éƒ½æœ‰è·¯ç”±åŠŸèƒ½
      const app = new Vue({
        router,
        data() {
          return {
            serverRoot: "https://yzyyna.github.io/",
          };
        },
        methods: {
          toUser() {
            this.$router.push("/user/5");
          },
          toIndex2() {
            window.location = this.serverRoot + "vue_router_demo/index2.html";
          },
        },
        watch: {
          $route(to, from) {
            // å¯¹è·¯ç”±å˜åŒ–ä½œå‡ºå“åº”...
            // console.log("$route changed", to, from);
          },
        },
      }).$mount("#app");

      // ç°åœ¨ï¼Œåº”ç”¨å·²ç»å¯åŠ¨äº†ï¼
    </script>
  </body>
</html>
